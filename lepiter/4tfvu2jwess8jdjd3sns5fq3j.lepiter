{
	"__schema" : "4.1",
	"__type" : "page",
	"children" : {
		"__type" : "snippets",
		"items" : [
			{
				"__type" : "textSnippet",
				"children" : {
					"__type" : "snippets",
					"items" : [ ]
				},
				"createEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"createTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:19:39.534341+02:00"
					}
				},
				"editEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"editTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:22:28.732619+02:00"
					}
				},
				"uid" : {
					"__type" : "uid",
					"uidString" : "MXTkxSb+DQCWbHr7B+5gUQ=="
				},
				"paragraphStyle" : {
					"__type" : "textStyle"
				},
				"string" : "This page explores memory leak issues that can appear when mixing weak and strong subscriptions within an announcer."
			},
			{
				"__type" : "textSnippet",
				"children" : {
					"__type" : "snippets",
					"items" : [
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:32.339699+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:19:25.680785+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "V9H4lib+DQCC26pyB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "An {{gtClass:Announcer}} has a a registry ({{gtClass:SubscriptionRegistry}} or {{gtClass:FastSubscriptionRegistry}}) that holds a list of subscriptions. "
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:38.062804+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:42.473925+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "7BlQlyb+DQCC48xWB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "Within a subscription registry there can be both strong ({{gtClass:AnnouncementSubscription}}) and weak ({{gtClass:WeakAnnouncementSubscription}}) subscriptions. "
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:46.714262+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:47.324915+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "ZR/Ulyb+DQCC7XwtB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "Strong subscriptions directly hold on to the receiver.  When {{gtMethod:Announcer>>#when:send:to:}} is used to create a strong subscription that sends a message to an object, a {{gtClass:MessageSend}} is created that captures the message send and  {{gtMethod:AnnouncementSubscription>>#subscriber}} also holds on to the receiver of the message."
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:08:31.471274+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:31:22.116348+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "1JcSnib+DQCEfzpHB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "When registering with the finalization registry, the weak subscription adds the subscriber object as the key of the ephemeron, and the actual weak subscription is added as the finalizer. So the weak subscription holds on weakly to the subscriber and if creates an ephemeron that also holds on to the subscriber weakly. There is no strong reference to the subscriber from the subscription."
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:11:07.265839+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:25:56.31109+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "JdRbpyb+DQCNB0EyB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "The ephemeron will call {{gtMethod:WeakAnnouncementSubscription>>#finalize}} when the subscriber object can be gargabe collected. When that is called the subscription removes itself from the subscription registry in the announcer ({{gtMethod:Announcer>>#removeSubscription:}}). At this point the subscription can be garbage collected as only the ephemeron holds on to it, and the ephemeron also removes itself from the finalization registry when {{gtMethod:FinalizationRegistryEntry>>#mourn}} is executed."
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:06:51.498619+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:29:10.062642+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "ch8dmCb+DQCC92W7B+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "Weak subscriptions are created by  {{gtClass:WeakSubscriptionBuilder}}.   In this case {{gtMethod:WeakSubscriptionBuilder>>#when:do:for:}} creates a {{gtClass:WeakAnnouncementSubscription}} . This is a weak class that holds on weakly to the subscriber ({{gtMethod:WeakAnnouncementSubscription>>#subscriber:}}). The subscription then registers itself with a {{gtClass:FinalizationRegistry}} in  {{gtMethod:WeakAnnouncementSubscription>>#register}} using an ephemeron."
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:31:44.64033+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:36:11.752379+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "3qcc8Sb+DQCfIF7sB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "{{gtMethod:WeakSubscriptionBuilder>>#when:send:to:}} creates a weak subscription that sends a message to a receiver using a {{gtClass:WeakMessageSend}}.  The subscription holds on strongly to the message send, but {{gtClass:WeakMessageSend}} is also a weak class that holds on weakly to the receiver.  So overall using a weak subscription does not create a strong reference to the receiver object."
						}
					]
				},
				"createEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"createTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:19:26.036838+02:00"
					}
				},
				"editEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"editTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:19:30.759802+02:00"
					}
				},
				"uid" : {
					"__type" : "uid",
					"uidString" : "VXoWxSb+DQCV5fcnB+5gUQ=="
				},
				"paragraphStyle" : {
					"__type" : "textStyle"
				},
				"string" : "#Announcements overview"
			},
			{
				"__type" : "textSnippet",
				"children" : {
					"__type" : "snippets",
					"items" : [
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:37:02.351084+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:47:47.338376+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "NpAMBCf+DQCpEEM6B+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "A case that with ephemerons no longer creates a memory leak is that of having within the same announcer both a strong and weak subscription to the same receiver object."
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:47:47.665892+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:49:06.686984+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "eUeDKif+DQCw1k9NB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "In this case we create `subscribedTarget` object that is an association with an {{gtClass:UUID}} as a key, and within the same announcer create both a strong and a weak subscription sending a message to that object."
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:49:07.090887+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:50:36.864694+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "Mjc/Lyf+DQC1+bfwB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "In this case if we remove both the announcer and the subscriber object after two garbage collects the subscriber object is no longer present in memory."
						},
						{
							"__type" : "pharoSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:37:57.304276+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:53:32.644568+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "7xdTByf+DQCtuQzEB+5gUQ=="
							},
							"code" : "| targetId subscribedTarget announcer |\rtargetId := UUID new.\r\nsubscribedTarget := Association new.\rsubscribedTarget key: targetId.\rsubscribedTarget value: 'target'.\n\nannouncer := Announcer new.\nannouncer\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\nannouncer weak\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\n\t\nannouncer := nil.\t\nsubscribedTarget := nil.\n\n2 timesRepeat: [ Smalltalk garbageCollect ].\nself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= targetId ])"
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:51:04.327273+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:51:25.819904+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "5/79NSf+DQC7KLg9B+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "This is a variant of the previous example where the announcer object is stored within the subscriber object."
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:51:53.62665+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:54:11.172578+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "E1gsOSf+DQC+NUYGB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "In this case after removing the reference to the subscriber object, the subscriber is garbaged collected successfully after two garbage collects."
									},
									{
										"__type" : "pharoSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:51:33.111614+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:53:48.097765+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "YlPzNyf+DQC9sIrlB+5gUQ=="
										},
										"code" : "| targetId subscribedTarget |\rtargetId := UUID new.\r\nsubscribedTarget := Association new.\rsubscribedTarget key: targetId.\rsubscribedTarget value: Announcer new.\n\nsubscribedTarget value\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\nsubscribedTarget value weak\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\n\t\nsubscribedTarget := nil.\n\n2 timesRepeat: [ Smalltalk garbageCollect ].\nself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= targetId ])"
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:50:41.531841+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:56:26.134302+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "6EfgNCf+DQC54GTeB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "###Having the target object holds on to the announcer"
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:56:40.716006+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:58:48.030097+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "LfpISif+DQCEO1x9B+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "In the examples above we do two garbage collects. The first garbage collect is needed to trigger the finalization mechanism for the receiver object. Then the second garbage collect will remove the instance."
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:58:48.357878+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:59:25.441574+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "wqXkUSf+DQCJlZSqB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "The example below registers a finalizer for the subscriber object that adds a log entry to the `finalizationLog` collection."
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:59:25.856507+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:04:22.947172+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "9dMgVCf+DQCMiNRyB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "In this case after removing the reference to the subscriber object the first garbage collect triggers the finalization, and the second removes the object from memory."
									},
									{
										"__type" : "pharoSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T22:57:43.331243+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:04:00.730209+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "220ETif+DQCJQq5RB+5gUQ=="
										},
										"code" : "| finalizationLog targetId subscribedTarget announcer |\rfinalizationLog := OrderedCollection new.\r\rtargetId := UUID new.\r\nsubscribedTarget := Association new.\rsubscribedTarget key: targetId.\rsubscribedTarget value: 'target'.\n\nannouncer := Announcer new.\nannouncer\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\nannouncer weak\n\twhen: Announcement \n\tsend: #yourself\n\tto: subscribedTarget.\r\t\rFinalizationRegistry  default \n\tadd: subscribedTarget\n\tfinalizer: (ObjectFinalizer new\n\t\treceiver: finalizationLog;\n\t\tselector: #add:;\n\t\targuments: {targetId printString}).\n\nannouncer := nil.\t\nsubscribedTarget := nil.\r\r\"First garbage collect triggers finalization\"\rSmalltalk garbageCollect.\rself assert: finalizationLog size equals: 1.\rself assert: finalizationLog first equals: targetId printString.\r\n\r\"Secong garbage collect, removes the reference to the receiver\"\nSmalltalk garbageCollect.\nself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= targetId ]).\r\t\rfinalizationLog"
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:55:36.761087+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T22:56:38.999549+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "LR95Rif+DQCCsw3vB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "###Looking at when finalization happens"
						}
					]
				},
				"createEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"createTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:36:23.55918+02:00"
					}
				},
				"editEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"editTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T22:37:00.819724+02:00"
					}
				},
				"uid" : {
					"__type" : "uid",
					"uidString" : "Oqi8ASf+DQCnTWDOB+5gUQ=="
				},
				"paragraphStyle" : {
					"__type" : "textStyle"
				},
				"string" : "#A weak and strong subscription for the same object"
			},
			{
				"__type" : "textSnippet",
				"children" : {
					"__type" : "snippets",
					"items" : [
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:05:18.612785+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:12:42.67069+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "EnYnaSf+DQCVu7QqB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "A different case is when within an announcer we have a strong and a weak subscription for two different objects."
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:13:56.305391+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:14:14.801304+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "OtQCiCf+DQCgeZOwB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "- references to both the strong and weak subscribers are removed"
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:14:15.178243+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:14:31.468693+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "gswiiSf+DQCiGszjB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "- only the reference to the strong subscriber is removed"
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:12:43.289992+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:13:55.996984+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "uLKogyf+DQCbA3iKB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "We will look at two cases based on how we remove references to the two object:"
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [ ]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:12:53.878565+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:13:33.360662+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "5URKhCf+DQCb4zjnB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "In both case we create two subscribers; one is registered strongly the other weakly. "
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:15:22.557368+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:16:14.823898+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "c+wmjSf+DQCknGVAB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "We remove the references to both subscribers."
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:16:18.951122+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:16:28.190392+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "kxZLkCf+DQClyP3yB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "After doing two garbage collects both subscribers are removed."
									},
									{
										"__type" : "pharoSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:10:41.956842+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:19:51.404426+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "R1BtfCf+DQCYwTmiB+5gUQ=="
										},
										"code" : "| stronglyTargetId weakTargetId stronglySubscribedTarget weaklySubscribedTarget  announcer |\r\rstronglyTargetId := UUID new.\rweakTargetId := UUID new.\r\r\nstronglySubscribedTarget := Association new.\rstronglySubscribedTarget key: stronglyTargetId.\rstronglySubscribedTarget value: 'strong target'.\r\r\nweaklySubscribedTarget := Association new.\rweaklySubscribedTarget key: weakTargetId.\rweaklySubscribedTarget value: 'weak target'.\r\r\nannouncer := Announcer new.\nannouncer\n\t\twhen: Announcement \n\t\tsend: #yourself\n\t\tto: stronglySubscribedTarget.\nannouncer weak\n\t\twhen: Announcement \n\t\tsend: #yourself\n\t\tto: weaklySubscribedTarget.\n\t\nannouncer := nil.\t\nstronglySubscribedTarget := nil.\nweaklySubscribedTarget := nil.\n\n2 timesRepeat: [ Smalltalk garbageCollect ].\nself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= stronglyTargetId ]).\rself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= weakTargetId ])."
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:15:08.752336+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:15:20.135623+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "Z0FUjCf+DQCjr4WeB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "###Case 1: Removing references to both targets"
						},
						{
							"__type" : "textSnippet",
							"children" : {
								"__type" : "snippets",
								"items" : [
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:18:14.149816+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:19:19.077404+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "+zphlyf+DQCouLJ3B+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "Now we just remove the reference to the strong subscriber."
									},
									{
										"__type" : "pharoSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:18:17.495117+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:23:16.144716+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "ekaUlyf+DQCovjGDB+5gUQ=="
										},
										"code" : "| stronglyTargetId weakTargetId stronglySubscribedTarget weaklySubscribedTarget  announcer |\r\rstronglyTargetId := UUID new.\rweakTargetId := UUID new.\r\r\nstronglySubscribedTarget := Association new.\rstronglySubscribedTarget key: stronglyTargetId.\rstronglySubscribedTarget value: 'strong target'.\r\r\nweaklySubscribedTarget := Association new.\rweaklySubscribedTarget key: weakTargetId.\rweaklySubscribedTarget value: 'weak target'.\r\r\nannouncer := Announcer new.\nannouncer\n\t\twhen: Announcement \n\t\tsend: #yourself\n\t\tto: stronglySubscribedTarget.\nannouncer weak\n\t\twhen: Announcement \n\t\tsend: #yourself\n\t\tto: weaklySubscribedTarget.\n\t\nannouncer := nil.\t\nstronglySubscribedTarget := nil.\n\"weaklySubscribedTarget := nil.\"\n\n2 timesRepeat: [ Smalltalk garbageCollect ].\nself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= stronglyTargetId ]) not. \"The reference is not removed\"\rself assert: (Association allInstances allSatisfy: [ :each | \n\teach key ~= weakTargetId ]) not. \"The reference is not removed\""
									},
									{
										"__type" : "textSnippet",
										"children" : {
											"__type" : "snippets",
											"items" : [ ]
										},
										"createEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"createTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:23:42.81347+02:00"
											}
										},
										"editEmail" : {
											"__type" : "email",
											"emailString" : "<unknown>"
										},
										"editTime" : {
											"__type" : "time",
											"time" : {
												"__type" : "dateAndTime",
												"dateAndTimeString" : "2025-10-22T23:23:48.32851+02:00"
											}
										},
										"uid" : {
											"__type" : "uid",
											"uidString" : "Sj34qif+DQCsJApAB+5gUQ=="
										},
										"paragraphStyle" : {
											"__type" : "textStyle"
										},
										"string" : "After we do two garbage collects"
									}
								]
							},
							"createEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"createTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:17:22.171996+02:00"
								}
							},
							"editEmail" : {
								"__type" : "email",
								"emailString" : "<unknown>"
							},
							"editTime" : {
								"__type" : "time",
								"time" : {
									"__type" : "dateAndTime",
									"dateAndTimeString" : "2025-10-22T23:18:06.383654+02:00"
								}
							},
							"uid" : {
								"__type" : "uid",
								"uidString" : "hxxIlCf+DQCnhpzkB+5gUQ=="
							},
							"paragraphStyle" : {
								"__type" : "textStyle"
							},
							"string" : "###Case 2: Removing the reference only to the strong subscriber"
						}
					]
				},
				"createEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"createTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T23:05:04.953245+02:00"
					}
				},
				"editEmail" : {
					"__type" : "email",
					"emailString" : "<unknown>"
				},
				"editTime" : {
					"__type" : "time",
					"time" : {
						"__type" : "dateAndTime",
						"dateAndTimeString" : "2025-10-22T23:26:30.485054+02:00"
					}
				},
				"uid" : {
					"__type" : "uid",
					"uidString" : "Is6pZif+DQCUkylHB+5gUQ=="
				},
				"paragraphStyle" : {
					"__type" : "textStyle"
				},
				"string" : "#Strong and weak subscriptions for different objects"
			}
		]
	},
	"createEmail" : {
		"__type" : "email",
		"emailString" : "<unknown>"
	},
	"createTime" : {
		"__type" : "time",
		"time" : {
			"__type" : "dateAndTime",
			"dateAndTimeString" : "2025-10-22T22:06:32.136893+02:00"
		}
	},
	"editEmail" : {
		"__type" : "email",
		"emailString" : "<unknown>"
	},
	"editTime" : {
		"__type" : "time",
		"time" : {
			"__type" : "dateAndTime",
			"dateAndTimeString" : "2025-10-22T22:20:56.217764+02:00"
		}
	},
	"pageType" : {
		"__type" : "namedPage",
		"title" : "Exploring memory leaks when mixing weak and strong subscriptions in announcers"
	},
	"uid" : {
		"__type" : "uuid",
		"uuid" : "dfb6f596-26fe-0d00-82da-295307ee6051"
	}
}